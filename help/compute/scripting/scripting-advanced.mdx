---
title: "Advanced scripting in Datagrok"
sidebar_position: 2
---

```mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import BrowserWindow from '@site/src/components/browser-window';
```

## Environments

### Python (using Conda)

You can specify an environment for the script to use,
including the language version and a set of libraries.

Datagrok uses [Conda](https://docs.Conda.io/en/latest/)
as the environment management system.
A Conda environment:

- isolates each script run,
- resolves dependencies,
- and takes time to be created before a script run.

Later, the script uses the pre-created environment with *no delay* for resolving dependencies.

In Datagrok, Conda environment configuration can be specified either [right inside the script](#specify-environment-in-place),
or as [part of a package](#specify-the-environment-in-a-package).

#### Specify environment in-place

Set an `environment` parameter of the script
to a one-liner YAML following the standard Conda YAML config (omit it's name).

For example, we need to use the following Conda config:

```yaml
name: envtest01
channels:
  - Conda-forge
dependencies:
  - python=3.8
  - glom
  - pip:
      - requests
```

To use it in a script, specify it as follows:

```python
#name: EnvTestInline
#environment: channels: [Conda-forge], dependencies: [python=3.8, glom, {pip: [requests]}]
#language: python
#output: string result

import re, requests
from glom import glom
import pandas as pd

target = {'a': {'b': {'c': 'd'}}}
result = glom(target, 'a.b.c')  # returns 'd'
```

:::tip First launch may take time

When the script runs the first time, Datagrok creates the environment on
the [Compute Virtual Machine](/help/develop/under-the-hood/infrastructure.md#compute-components),
which may take up to several minutes.
For all next script runs, Datagrok will reuse this environment.

:::

Datagrok distinguishes in-place environments using *MD5 hashes* of their body strings.
If there is a ready-to-use environment with the same environment config, Datagrok will reuse it.

## Integration

Datagrok is designed to be as extensible and as easy to integrate as possible.
So, out of the box, we get many platform integration capabilities such as authentication, data access,
and many others.
In addition to that,
there are some capabilities specific for developers: [REST API](#rest-api) and
[embedding as iframe](#embedding-as-iframe).

### Datagrok platform UI integration

The [functional annotations](/help/datagrok/concepts/functions/func-params-annotation.md)
provide you with several integration options that you can use with any function of script.
Here are some useful examples.

#### Info panel

Add your function to the [info panel](/help/explore/data-augmentation/info-panels)
to display custom information for your data.
To do this, specify [semantic type](getting-started#semantic-types),
for the script input, add `panel` tag and `condition` annotation.
Read the detailed instruction in the corresponding
[developer's howto sections](/help/develop/how-to/add-info-panel#scripts).

## Parameters

### Parameter validators

Validators check whether the value falls in the expected range, and provide visual cue if it does not. To add a
validator to a parameter, provide a comma-separated list of functions that will be invoked each time a value is changed.
A null indicates that the value is valid, anything else indicates an error which gets shown to the user.

A validator is a function that accepts one parameter of any type and returns a string. Choice providers are applicable
only to string parameters.

```mdx-code-block
<Tabs>
<TabItem value="result" label="Result">
```

```mdx-code-block
<BrowserWindow url=''>
```

<img src={require('../../uploads/features/script-param-validators.gif').default} style={{'box-shadow': '#4D5261 0px 0px 5px', 'border': '1px solid #F2F2F5'}}/>

```mdx-code-block
</BrowserWindow>
```

```mdx-code-block
</TabItem>
<TabItem value="creation" label="Register validators">
```

```js title="Run this code once"
grok.functions.register({
    signature: 'List<String> jsVal1(int input)',
    run: (input) => input < 11 ? null : "Error val1" });

grok.functions.register({
    signature: 'List<String> jsVal2(int input)',
    run: (input) => input > 9 ? null : "Error val2" });
```

```mdx-code-block
</TabItem>
<TabItem value="usage" label="Use valdiators">
```

```python title="https://public.datagrok.ai/scripts"
#name: Numbers
#language: python title="Use registered validators"
#input: int count1 {validators: ["jsval1", "jsval2"]} [Number of cells in table]
#input: int count2 {validators: ["jsval1"]} [Number of cells in table]
#input: int count3 {validators: ["jsval2"]} [Number of cells in table]
```

```mdx-code-block
</TabItem>
</Tabs>
```

### Examples

The list of parameter examples can be used:

```python
#input: dataframe t1 {columns:numerical} [first input data table]
#input: dataframe t2 {columns:numerical} [second input data table]
#input: column x {type:numerical; table:t1} [x axis column name]
#input: column y {type:numerical} [y axis column name]
#input: column date {type:datetime; format:mm/dd/yyyy} [date column name]
#input: column_list numdata {type:numerical; table:t1} [numerical columns names]
#input: int numcomp = 2 {range:2-7} [number of components]
#input: bool center = true [number of components]
#input: string type = high {choices: ["high", "low"]} [type of filter]
#output: dataframe result {action:join(t1)} [pca components]
#output: graphics scatter [scatter plot]
```

## Output values validation

Datagrok functions return zero, one or more typed variables.
Datagrok expects that all variables are defined in the script code and have proper values by the end of the script run.
If this doesn't happen, the two things will follow:

1. The unset output values will be returned as `null`-s.
2. A warning `Output value ${output.param.name} was not set` will be printed in the
   [Datagrok Console](/help/datagrok/navigation/navigation.md#console).
   Open it pressing `~` key or clicking **Console** <i class="fas fa-terminal"></i> button
   in the right bottom corner of the screen.

In this script, the value `c3` is missed to be set:

```r title="R script with missing output value"
#name: TestMissingInputsR
#language: r
#output: int c1
#output: int c2
#output: int c3
c1 <- 12
c2 <- 15
```

Running the script produces the following output to the console:

```mdx-code-block
<BrowserWindow bodyStyle={{'padding': '0px'}} url=''>
```

```
Output value c3 was not set
  c1: 12
  c2: 15
  c3: null
```

```mdx-code-block
</BrowserWindow>
```

