name: Common Checks

on:
  workflow_call:
    inputs:
      run_trigger:
        required: false
        type: string
    outputs:
      continue: 
        description: "Run nested actions if checks passed"
        value: ${{ jobs.check.outputs.continue }}

jobs:
  check:
    name: Check changes
    runs-on: ubuntu-20.04
    outputs:
      continue: ${{ steps.merge-details.outputs.continue_action }}
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Check merge commit
        id: merge-details
        run: |
          if [[ ${{ inputs.run_trigger }} != 'workflow_dispatch' ]] && { [[ $(git log -n 1 --pretty=%B) == *"Merge branch 'master'"* ]] || [[ $(git log -n 1 --pretty=%B) == *"Merge remote-tracking branch 'origin/master'"* ]]; };  then
            echo "continue_action=false" >> $GITHUB_OUTPUT
            echo "This is a merge commit push. No actions will be run"
          else
            echo "continue_action=true" >> $GITHUB_OUTPUT
            echo "This is no merge commit push. Actions will be run"
          fi
