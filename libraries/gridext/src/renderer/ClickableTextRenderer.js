import * as GridUtils from '../utils/GridUtils';
import * as RendUtils from './RendUtils';
import { GridCellRendererEx } from "./GridCellRendererEx";
function isNullText(cell) {
    const bNull = cell === null || cell === undefined || cell.value === null || cell.value === undefined;
    return bNull;
}
export class ClickableTextRenderer extends GridCellRendererEx {
    constructor(onTextClicked) {
        super();
        this.onTextClickCallback = onTextClicked !== undefined ? onTextClicked : null;
    }
    render(g, nX, nY, nW, nH, cellGrid, style) {
        const cell = cellGrid.cell;
        let str = isNullText(cell) ? null : cell.value.toString();
        if (str === null) {
            return;
        }
        //str = TextUtils.trimText(str, g, nW);
        const strFont = style.font;
        /*
        if (strFont !== null && strFont !== undefined && strFont !== '') {
          g.font = strFont;
        }*/
        RendUtils.renderXYCenteredText(str, g, nX, nY, nW, nH, strFont, 'DodgerBlue');
        /*
        let tm = g.measureText(str);
        const nWLabel = Math.round(tm.width);
        const nYInset = 2;
        tm = g.measureText('W');
        const nAscent = Math.abs(tm.actualBoundingBoxAscent);
        const nDescent = tm.actualBoundingBoxDescent;
        const nHFont : number = nAscent + nDescent + 2 * nYInset;
    
        const nDeltaY : number = Math.floor((nH - nHFont) / 2);
        const nYY = nY + nDeltaY + nHFont;
        g.fillStyle = 'black';
        const strBaseOld = g.textBaseline;
        g.textBaseline = 'top';
        const nXX = nX + ((nW - nWLabel) / 2);
    
        g.textAlign = 'start';
        g.fillStyle = 'DodgerBlue';
        g.fillText(str, nXX, nYY - nHFont + nYInset);
        g.textBaseline = strBaseOld;*/
    }
    isClickable(cellGrid, nXOnCell, nYOnCell) {
        const cell = cellGrid.cell;
        const str = isNullText(cell) ? null : cellGrid.cell.value.toString();
        if (str === null) {
            return false;
        }
        const eCanvas = cellGrid.grid.overlay;
        const g = eCanvas.getContext('2d');
        if (g === null) {
            return false;
        }
        const strFont = cellGrid.style.font;
        if (strFont !== null && strFont !== undefined && strFont !== '') {
            g.font = strFont;
        }
        let tm = g.measureText(str);
        const nWLabel = Math.round(tm.width);
        const nYInset = 2;
        tm = g.measureText('W');
        const nAscent = Math.abs(tm.actualBoundingBoxAscent);
        const nDescent = tm.actualBoundingBoxDescent;
        const nHFont = nAscent + nDescent + 2 * nYInset;
        const nHRow = GridUtils.getGridRowHeight(cellGrid.grid);
        const nDeltaY = Math.floor((nHRow - nHFont) / 2);
        const nXX = 0 + ((cellGrid.gridColumn.width - nWLabel) / 2);
        const bX = nXX <= 0 || (nXOnCell >= nXX && nXOnCell <= nXX + nWLabel);
        if (!bX) {
            return false;
        }
        const bY = nDeltaY < 0 || (nYOnCell >= nDeltaY && nYOnCell <= nDeltaY + nHFont);
        return bY;
    }
    onTextClicked(cellGrid) {
        if (this.onTextClickCallback !== null)
            this.onTextClickCallback(cellGrid);
        //window.open("https://www.w3schools.com");
    }
    onMouseUpEx(cellGrid, e, nXOnCell, nYOnCell) {
        if (document.body.style.cursor !== 'auto') {
            document.body.style.cursor = 'auto';
        }
        const b = this.isClickable(cellGrid, nXOnCell, nYOnCell);
        if (b)
            this.onTextClicked(cellGrid);
    }
    onMouseMoveEx(cellGrid, e, nXOnCell, nYOnCell) {
        //console.log('Move');
        if (e.buttons !== 0) {
            return;
        }
        const b = this.isClickable(cellGrid, nXOnCell, nYOnCell);
        if (b) {
            if (document.body.style.cursor !== 'pointer') {
                document.body.style.cursor = 'pointer';
            }
        }
        else {
            if (document.body.style.cursor !== 'auto') {
                document.body.style.cursor = 'auto';
            }
        }
        //this.onMouseMove(cellGrid, e);
    }
    onMouseLeaveEx(cellGrid, e, nXOnCell, nYOnCell) {
        //console.log('Out');
        document.body.style.cursor = 'auto';
        //this.onMouseLeave(cellGrid, e);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2xpY2thYmxlVGV4dFJlbmRlcmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ2xpY2thYmxlVGV4dFJlbmRlcmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sS0FBSyxTQUFTLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxLQUFLLFNBQVMsTUFBTSxhQUFhLENBQUM7QUFDekMsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFFeEQsU0FBUyxVQUFVLENBQUMsSUFBYztJQUNoQyxNQUFNLEtBQUssR0FBYSxJQUFJLEtBQUssSUFBSSxJQUFJLElBQUksS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUM7SUFDL0csT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsTUFBTSxPQUFPLHFCQUFzQixTQUFRLGtCQUFrQjtJQUczRCxZQUFZLGFBQStDO1FBQ3pELEtBQUssRUFBRSxDQUFDO1FBRVIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLGFBQWEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2hGLENBQUM7SUFDRCxNQUFNLENBQUMsQ0FBNEIsRUFBRSxFQUFXLEVBQUUsRUFBVyxFQUFFLEVBQVcsRUFBRSxFQUFXLEVBQUUsUUFBc0IsRUFBRSxLQUF3QjtRQUN2SSxNQUFNLElBQUksR0FBYSxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQ3JDLElBQUksR0FBRyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzFELElBQUksR0FBRyxLQUFLLElBQUksRUFBRTtZQUNoQixPQUFPO1NBQ1I7UUFFRCx1Q0FBdUM7UUFDdkMsTUFBTSxPQUFP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cUJBQXFCO1FBQ3JCLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDcEMsaUNBQWlDO0lBQ25DLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIERHIGZyb20gJ2RhdGFncm9rLWFwaS9kZyc7XHJcbmltcG9ydCAqIGFzIEdyaWRVdGlscyBmcm9tICcuLi91dGlscy9HcmlkVXRpbHMnO1xyXG5pbXBvcnQgKiBhcyBSZW5kVXRpbHMgZnJvbSAnLi9SZW5kVXRpbHMnO1xyXG5pbXBvcnQge0dyaWRDZWxsUmVuZGVyZXJFeH0gZnJvbSBcIi4vR3JpZENlbGxSZW5kZXJlckV4XCI7XHJcblxyXG5mdW5jdGlvbiBpc051bGxUZXh0KGNlbGwgOiBERy5DZWxsKSA6IGJvb2xlYW4ge1xyXG4gIGNvbnN0IGJOdWxsIDogYm9vbGVhbiA9IGNlbGwgPT09IG51bGwgfHwgY2VsbCA9PT0gdW5kZWZpbmVkIHx8IGNlbGwudmFsdWUgPT09IG51bGwgfHwgY2VsbC52YWx1ZSA9PT0gdW5kZWZpbmVkO1xyXG4gIHJldHVybiBiTnVsbDtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIENsaWNrYWJsZVRleHRSZW5kZXJlciBleHRlbmRzIEdyaWRDZWxsUmVuZGVyZXJFeCB7XHJcbiAgcHJpdmF0ZSBvblRleHRDbGlja0NhbGxiYWNrOiAoKGdyaWRDZWxsOiBERy5HcmlkQ2VsbCkgPT4gdm9pZCkgfCBudWxsO1xyXG5cclxuICBjb25zdHJ1Y3RvcihvblRleHRDbGlja2VkPzogKGdyaWRDZWxsOiBERy5HcmlkQ2VsbCkgPT4gdm9pZCkge1xyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICB0aGlzLm9uVGV4dENsaWNrQ2FsbGJhY2sgPSBvblRleHRDbGlja2VkICE9PSB1bmRlZmluZWQgPyBvblRleHRDbGlja2VkIDogbnVsbDtcclxuICB9XHJcbiAgcmVuZGVyKGcgOiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIG5YIDogbnVtYmVyLCBuWSA6IG51bWJlciwgblcgOiBudW1iZXIsIG5IIDogbnVtYmVyLCBjZWxsR3JpZCA6IERHLkdyaWRDZWxsLCBzdHlsZSA6IERHLkdyaWRDZWxsU3R5bGUpIDogdm9pZCB7XHJcbiAgICBjb25zdCBjZWxsIDogREcuQ2VsbCA9IGNlbGxHcmlkLmNlbGw7XHJcbiAgICBsZXQgc3RyID0gaXNOdWxsVGV4dChjZWxsKSA/IG51bGwgOiBjZWxsLnZhbHVlLnRvU3RyaW5nKCk7XHJcbiAgICBpZiAoc3RyID09PSBudWxsKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICAvL3N0ciA9IFRleHRVdGlscy50cmltVGV4dChzdHIsIGcsIG5XKTtcclxuICAgIGNvbnN0IHN0ckZvbnQgOiBzdHJpbmcgID0gc3R5bGUuZm9udDtcclxuICAgIC8qXHJcbiAgICBpZiAoc3RyRm9udCAhPT0gbnVsbCAmJiBzdHJGb250ICE9PSB1bmRlZmluZWQgJiYgc3RyRm9udCAhPT0gJycpIHtcclxuICAgICAgZy5mb250ID0gc3RyRm9udDtcclxuICAgIH0qL1xyXG4gICAgUmVuZFV0aWxzLnJlbmRlclhZQ2VudGVyZWRUZXh0KHN0ciwgZywgblgsIG5ZLCBuVywgbkgsIHN0ckZvbnQsICdEb2RnZXJCbHVlJyk7XHJcbiAgICAvKlxyXG4gICAgbGV0IHRtID0gZy5tZWFzdXJlVGV4dChzdHIpO1xyXG4gICAgY29uc3QgbldMYWJlbCA9IE1hdGgucm91bmQodG0ud2lkdGgpO1xyXG4gICAgY29uc3QgbllJbnNldCA9IDI7XHJcbiAgICB0bSA9IGcubWVhc3VyZVRleHQoJ1cnKTtcclxuICAgIGNvbnN0IG5Bc2NlbnQgPSBNYXRoLmFicyh0bS5hY3R1YWxCb3VuZGluZ0JveEFzY2VudCk7XHJcbiAgICBjb25zdCBuRGVzY2VudCA9IHRtLmFjdHVhbEJvdW5kaW5nQm94RGVzY2VudDtcclxuICAgIGNvbnN0IG5IRm9udCA6IG51bWJlciA9IG5Bc2NlbnQgKyBuRGVzY2VudCArIDIgKiBuWUluc2V0O1xyXG5cclxuICAgIGNvbnN0IG5EZWx0YVkgOiBudW1iZXIgPSBNYXRoLmZsb29yKChuSCAtIG5IRm9udCkgLyAyKTtcclxuICAgIGNvbnN0IG5ZWSA9IG5ZICsgbkRlbHRhWSArIG5IRm9udDtcclxuICAgIGcuZmlsbFN0eWxlID0gJ2JsYWNrJztcclxuICAgIGNvbnN0IHN0ckJhc2VPbGQgPSBnLnRleHRCYXNlbGluZTtcclxuICAgIGcudGV4dEJhc2VsaW5lID0gJ3RvcCc7XHJcbiAgICBjb25zdCBuWFggPSBuWCArICgoblcgLSBuV0xhYmVsKSAvIDIpO1xyXG5cclxuICAgIGcudGV4dEFsaWduID0gJ3N0YXJ0JztcclxuICAgIGcuZmlsbFN0eWxlID0gJ0RvZGdlckJsdWUnO1xyXG4gICAgZy5maWxsVGV4dChzdHIsIG5YWCwgbllZIC0gbkhGb250ICsgbllJbnNldCk7XHJcbiAgICBnLnRleHRCYXNlbGluZSA9IHN0ckJhc2VPbGQ7Ki9cclxuICB9XHJcblxyXG4gIGlzQ2xpY2thYmxlKGNlbGxHcmlkIDogREcuR3JpZENlbGwsIG5YT25DZWxsIDogbnVtYmVyLCBuWU9uQ2VsbCA6IG51bWJlcikgOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGNlbGwgOiBERy5DZWxsID0gY2VsbEdyaWQuY2VsbDtcclxuICAgIGNvbnN0IHN0ciA6IHN0cmluZyA9IGlzTnVsbFRleHQoY2VsbCkgPyBudWxsIDogY2VsbEdyaWQuY2VsbC52YWx1ZS50b1N0cmluZygpO1xyXG4gICAgaWYgKHN0ciA9PT0gbnVsbCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBjb25zdCBlQ2FudmFzID0gY2VsbEdyaWQuZ3JpZC5vdmVybGF5O1xyXG4gICAgY29uc3QgZyA9IGVDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcclxuICAgIGlmKGcgPT09IG51bGwpIHtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHN0ckZvbnQgOiBzdHJpbmcgID0gY2VsbEdyaWQuc3R5bGUuZm9udDtcclxuICAgIGlmIChzdHJGb250ICE9PSBudWxsICYmIHN0ckZvbnQgIT09IHVuZGVmaW5lZCAmJiBzdHJGb250ICE9PSAnJykge1xyXG4gICAgICBnLmZvbnQgPSBzdHJGb250O1xyXG4gICAgfVxyXG5cclxuICAgIGxldCB0bSA9IGcubWVhc3VyZVRleHQoc3RyKTtcclxuICAgIGNvbnN0IG5XTGFiZWwgPSBNYXRoLnJvdW5kKHRtLndpZHRoKTtcclxuICAgIGNvbnN0IG5ZSW5zZXQgPSAyO1xyXG4gICAgdG0gPSBnLm1lYXN1cmVUZXh0KCdXJyk7XHJcbiAgICBjb25zdCBuQXNjZW50ID0gTWF0aC5hYnModG0uYWN0dWFsQm91bmRpbmdCb3hBc2NlbnQpO1xyXG4gICAgY29uc3QgbkRlc2NlbnQgPSB0bS5hY3R1YWxCb3VuZGluZ0JveERlc2NlbnQ7XHJcbiAgICBjb25zdCBuSEZvbnQgPSBuQXNjZW50ICsgbkRlc2NlbnQgKyAyICogbllJbnNldDtcclxuXHJcbiAgICBjb25zdCBuSFJvdyA9IEdyaWRVdGlscy5nZXRHcmlkUm93SGVpZ2h0KGNlbGxHcmlkLmdyaWQpO1xyXG4gICAgY29uc3QgbkRlbHRhWSA9IE1hdGguZmxvb3IoKG5IUm93IC0gbkhGb250KSAvIDIpO1xyXG4gICAgY29uc3QgblhYID0gMCArICgoY2VsbEdyaWQuZ3JpZENvbHVtbi53aWR0aCAtIG5XTGFiZWwpIC8gMik7XHJcbiAgICBjb25zdCBiWCA9IG5YWCA8PSAwIHx8IChuWE9uQ2VsbCA+PSBuWFggJiYgblhPbkNlbGwgPD0gblhYICsgbldMYWJlbCk7XHJcbiAgICBpZiAoIWJYKSB7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIGNvbnN0IGJZID0gbkRlbHRhWSA8IDAgfHwgKG5ZT25DZWxsID49IG5EZWx0YVkgJiYgbllPbkNlbGwgPD0gbkRlbHRhWSArIG5IRm9udCk7XHJcbiAgICByZXR1cm4gYlk7XHJcbiAgfVxyXG5cclxuXHJcbiAgb25UZXh0Q2xpY2tlZChjZWxsR3JpZCA6IERHLkdyaWRDZWxsKSB7XHJcblxyXG4gICAgaWYgKCB0aGlzLm9uVGV4dENsaWNrQ2FsbGJhY2sgIT09IG51bGwpXHJcbiAgICAgIHRoaXMub25UZXh0Q2xpY2tDYWxsYmFjayhjZWxsR3JpZCk7XHJcbiAgICAvL3dpbmRvdy5vcGVuKFwiaHR0cHM6Ly93d3cudzNzY2hvb2xzLmNvbVwiKTtcclxuICB9XHJcblxyXG4gIG9uTW91c2VVcEV4KGNlbGxHcmlkIDogREcuR3JpZENlbGwsIGUgOiBNb3VzZUV2ZW50LCBuWE9uQ2VsbCA6IG51bWJlciwgbllPbkNlbGwgOiBudW1iZXIpIDogdm9pZCB7XHJcbiAgICBpZiAoZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgIT09ICdhdXRvJykge1xyXG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICdhdXRvJztcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBiID0gdGhpcy5pc0NsaWNrYWJsZShjZWxsR3JpZCwgblhPbkNlbGwsIG5ZT25DZWxsKTtcclxuICAgIGlmKGIpXHJcbiAgICAgIHRoaXMub25UZXh0Q2xpY2tlZChjZWxsR3JpZCk7XHJcbiAgfVxyXG5cclxuICBvbk1vdXNlTW92ZUV4KGNlbGxHcmlkIDogREcuR3JpZENlbGwsIGUgOiBNb3VzZUV2ZW50LCBuWE9uQ2VsbCA6IG51bWJlciwgbllPbkNlbGwgOiBudW1iZXIpIDogdm9pZCB7XHJcbiAgICAvL2NvbnNvbGUubG9nKCdNb3ZlJyk7XHJcblxyXG4gICAgaWYoZS5idXR0b25zICE9PSAwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBiID0gdGhpcy5pc0NsaWNrYWJsZShjZWxsR3JpZCwgblhPbkNlbGwsIG5ZT25DZWxsKTtcclxuICAgIGlmIChiKSB7XHJcbiAgICAgIGlmIChkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPT0gJ3BvaW50ZXInKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGlmIChkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciAhPT0gJ2F1dG8nKSB7XHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnYXV0byc7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vdGhpcy5vbk1vdXNlTW92ZShjZWxsR3JpZCwgZSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgb25Nb3VzZUxlYXZlRXgoY2VsbEdyaWQgOiBERy5HcmlkQ2VsbCwgZSA6IE1vdXNlRXZlbnQsIG5YT25DZWxsIDogbnVtYmVyLCBuWU9uQ2VsbCA6IG51bWJlcikgOiB2b2lkIHtcclxuICAgIC8vY29uc29sZS5sb2coJ091dCcpO1xyXG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnYXV0byc7XHJcbiAgICAvL3RoaXMub25Nb3VzZUxlYXZlKGNlbGxHcmlkLCBlKTtcclxuICB9XHJcbn1cclxuIl19