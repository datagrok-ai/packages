import * as GridUtils from '../utils/GridUtils';
import * as RendUtils from './RendUtils';
import { GridCellRendererEx } from "./GridCellRendererEx";
function isNullText(cell) {
    const bNull = cell === null || cell === undefined || cell.value === null || cell.value === undefined;
    return bNull;
}
export class ClickableTextRenderer extends GridCellRendererEx {
    constructor(onTextClicked) {
        super();
        this.onTextClickCallback = onTextClicked !== undefined ? onTextClicked : null;
    }
    render(g, nX, nY, nW, nH, cellGrid, style) {
        const cell = cellGrid.cell;
        let str = isNullText(cell) ? null : cell.value.toString();
        if (str === null) {
            return;
        }
        //str = TextUtils.trimText(str, g, nW);
        const strFont = style.font;
        RendUtils.renderXYCenteredText(str, g, nX, nY, nW, nH, strFont, 'DodgerBlue');
    }
    isClickable(cellGrid, nXOnCell, nYOnCell) {
        const cell = cellGrid.cell;
        const str = isNullText(cell) ? null : cellGrid.cell.value.toString();
        if (str === null)
            return false;
        const eCanvas = cellGrid.grid.overlay;
        const g = eCanvas.getContext('2d');
        if (g === null)
            return false;
        const strFont = cellGrid.style.font;
        if (strFont !== null && strFont !== undefined && strFont !== '')
            g.font = strFont;
        let tm = g.measureText(str);
        const nWLabel = Math.round(tm.width);
        const nYInset = 2;
        tm = g.measureText('W');
        const nAscent = Math.abs(tm.actualBoundingBoxAscent);
        const nDescent = tm.actualBoundingBoxDescent;
        const nHFont = nAscent + nDescent + 2 * nYInset;
        const nHRow = GridUtils.getGridRowHeight(cellGrid.grid);
        const nDeltaY = Math.floor((nHRow - nHFont) / 2);
        const nXX = 0 + ((cellGrid.gridColumn.width - nWLabel) / 2);
        const bX = nXX <= 0 || (nXOnCell >= nXX && nXOnCell <= nXX + nWLabel);
        if (!bX) {
            return false;
        }
        const bY = nDeltaY < 0 || (nYOnCell >= nDeltaY && nYOnCell <= nDeltaY + nHFont);
        return bY;
    }
    onTextClicked(cellGrid) {
        if (this.onTextClickCallback !== null)
            this.onTextClickCallback(cellGrid);
        //window.open("https://www.w3schools.com");
    }
    onMouseUpEx(cellGrid, e, nXOnCell, nYOnCell) {
        if (document.body.style.cursor !== 'auto')
            document.body.style.cursor = 'auto';
        if (e.button !== 0)
            return;
        const b = this.isClickable(cellGrid, nXOnCell, nYOnCell);
        if (b)
            this.onTextClicked(cellGrid);
    }
    onMouseMoveEx(cellGrid, e, nXOnCell, nYOnCell) {
        //console.log('Move');
        if (e.button !== 0)
            return;
        const b = this.isClickable(cellGrid, nXOnCell, nYOnCell);
        if (b) {
            if (document.body.style.cursor !== 'pointer')
                document.body.style.cursor = 'pointer';
        }
        else {
            if (document.body.style.cursor !== 'auto')
                document.body.style.cursor = 'auto';
        }
        //this.onMouseMove(cellGrid, e);
    }
    onMouseLeaveEx(cellGrid, e, nXOnCell, nYOnCell) {
        //console.log('Out');
        document.body.style.cursor = 'auto';
        //this.onMouseLeave(cellGrid, e);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ2xpY2thYmxlVGV4dFJlbmRlcmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiQ2xpY2thYmxlVGV4dFJlbmRlcmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sS0FBSyxTQUFTLE1BQU0sb0JBQW9CLENBQUM7QUFDaEQsT0FBTyxLQUFLLFNBQVMsTUFBTSxhQUFhLENBQUM7QUFDekMsT0FBTyxFQUFDLGtCQUFrQixFQUFDLE1BQU0sc0JBQXNCLENBQUM7QUFFeEQsU0FBUyxVQUFVLENBQUMsSUFBYztJQUNoQyxNQUFNLEtBQUssR0FBYSxJQUFJLEtBQUssSUFBSSxJQUFJLElBQUksS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUM7SUFDL0csT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsTUFBTSxPQUFPLHFCQUFzQixTQUFRLGtCQUFrQjtJQUczRCxZQUFZLGFBQStDO1FBQ3pELEtBQUssRUFBRSxDQUFDO1FBRVIsSUFBSSxDQUFDLG1CQUFtQixHQUFHLGFBQWEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBQ2hGLENBQUM7SUFDRCxNQUFNLENBQUMsQ0FBNEIsRUFBRSxFQUFXLEVBQUUsRUFBVyxFQUFFLEVBQVcsRUFBRSxFQUFXLEVBQUUsUUFBc0IsRUFBRSxLQUF3QjtRQUN2SSxNQUFNLElBQUksR0FBYSxRQUFRLENBQUMsSUFBSSxDQUFDO1FBQ3JDLElBQUksR0FBRyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzFELElBQUksR0FBRyxLQUFLLElBQUksRUFBRTtZQUNoQixPQUFPO1NBQ1I7UUFFRCx1Q0FBdUM7UUFDdkMsTUFBTSxPQUFP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QUFpQztJQUNuQyxDQUFDO0NBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBERyBmcm9tICdkYXRhZ3Jvay1hcGkvZGcnO1xyXG5pbXBvcnQgKiBhcyBHcmlkVXRpbHMgZnJvbSAnLi4vdXRpbHMvR3JpZFV0aWxzJztcclxuaW1wb3J0ICogYXMgUmVuZFV0aWxzIGZyb20gJy4vUmVuZFV0aWxzJztcclxuaW1wb3J0IHtHcmlkQ2VsbFJlbmRlcmVyRXh9IGZyb20gXCIuL0dyaWRDZWxsUmVuZGVyZXJFeFwiO1xyXG5cclxuZnVuY3Rpb24gaXNOdWxsVGV4dChjZWxsIDogREcuQ2VsbCkgOiBib29sZWFuIHtcclxuICBjb25zdCBiTnVsbCA6IGJvb2xlYW4gPSBjZWxsID09PSBudWxsIHx8IGNlbGwgPT09IHVuZGVmaW5lZCB8fCBjZWxsLnZhbHVlID09PSBudWxsIHx8IGNlbGwudmFsdWUgPT09IHVuZGVmaW5lZDtcclxuICByZXR1cm4gYk51bGw7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBDbGlja2FibGVUZXh0UmVuZGVyZXIgZXh0ZW5kcyBHcmlkQ2VsbFJlbmRlcmVyRXgge1xyXG4gIHByaXZhdGUgb25UZXh0Q2xpY2tDYWxsYmFjazogKChncmlkQ2VsbDogREcuR3JpZENlbGwpID0+IHZvaWQpIHwgbnVsbDtcclxuXHJcbiAgY29uc3RydWN0b3Iob25UZXh0Q2xpY2tlZD86IChncmlkQ2VsbDogREcuR3JpZENlbGwpID0+IHZvaWQpIHtcclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5vblRleHRDbGlja0NhbGxiYWNrID0gb25UZXh0Q2xpY2tlZCAhPT0gdW5kZWZpbmVkID8gb25UZXh0Q2xpY2tlZCA6IG51bGw7XHJcbiAgfVxyXG4gIHJlbmRlcihnIDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBuWCA6IG51bWJlciwgblkgOiBudW1iZXIsIG5XIDogbnVtYmVyLCBuSCA6IG51bWJlciwgY2VsbEdyaWQgOiBERy5HcmlkQ2VsbCwgc3R5bGUgOiBERy5HcmlkQ2VsbFN0eWxlKSA6IHZvaWQge1xyXG4gICAgY29uc3QgY2VsbCA6IERHLkNlbGwgPSBjZWxsR3JpZC5jZWxsO1xyXG4gICAgbGV0IHN0ciA9IGlzTnVsbFRleHQoY2VsbCkgPyBudWxsIDogY2VsbC52YWx1ZS50b1N0cmluZygpO1xyXG4gICAgaWYgKHN0ciA9PT0gbnVsbCkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgLy9zdHIgPSBUZXh0VXRpbHMudHJpbVRleHQoc3RyLCBnLCBuVyk7XHJcbiAgICBjb25zdCBzdHJGb250IDogc3RyaW5nICA9IHN0eWxlLmZvbnQ7XHJcbiAgICBSZW5kVXRpbHMucmVuZGVyWFlDZW50ZXJlZFRleHQoc3RyLCBnLCBuWCwgblksIG5XLCBuSCwgc3RyRm9udCwgJ0RvZGdlckJsdWUnKTtcclxuICB9XHJcblxyXG4gIGlzQ2xpY2thYmxlKGNlbGxHcmlkIDogREcuR3JpZENlbGwsIG5YT25DZWxsIDogbnVtYmVyLCBuWU9uQ2VsbCA6IG51bWJlcikgOiBib29sZWFuIHtcclxuICAgIGNvbnN0IGNlbGwgOiBERy5DZWxsID0gY2VsbEdyaWQuY2VsbDtcclxuICAgIGNvbnN0IHN0ciA6IHN0cmluZyA9IGlzTnVsbFRleHQoY2VsbCkgPyBudWxsIDogY2VsbEdyaWQuY2VsbC52YWx1ZS50b1N0cmluZygpO1xyXG4gICAgaWYgKHN0ciA9PT0gbnVsbClcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IGVDYW52YXMgPSBjZWxsR3JpZC5ncmlkLm92ZXJsYXk7XHJcbiAgICBjb25zdCBnID0gZUNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgaWYoZyA9PT0gbnVsbClcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG5cclxuICAgIGNvbnN0IHN0ckZvbnQgOiBzdHJpbmcgID0gY2VsbEdyaWQuc3R5bGUuZm9udDtcclxuICAgIGlmIChzdHJGb250ICE9PSBudWxsICYmIHN0ckZvbnQgIT09IHVuZGVmaW5lZCAmJiBzdHJGb250ICE9PSAnJylcclxuICAgICAgZy5mb250ID0gc3RyRm9udDtcclxuXHJcbiAgICBsZXQgdG0gPSBnLm1lYXN1cmVUZXh0KHN0cik7XHJcbiAgICBjb25zdCBuV0xhYmVsID0gTWF0aC5yb3VuZCh0bS53aWR0aCk7XHJcbiAgICBjb25zdCBuWUluc2V0ID0gMjtcclxuICAgIHRtID0gZy5tZWFzdXJlVGV4dCgnVycpO1xyXG4gICAgY29uc3QgbkFzY2VudCA9IE1hdGguYWJzKHRtLmFjdHVhbEJvdW5kaW5nQm94QXNjZW50KTtcclxuICAgIGNvbnN0IG5EZXNjZW50ID0gdG0uYWN0dWFsQm91bmRpbmdCb3hEZXNjZW50O1xyXG4gICAgY29uc3QgbkhGb250ID0gbkFzY2VudCArIG5EZXNjZW50ICsgMiAqIG5ZSW5zZXQ7XHJcblxyXG4gICAgY29uc3QgbkhSb3cgPSBHcmlkVXRpbHMuZ2V0R3JpZFJvd0hlaWdodChjZWxsR3JpZC5ncmlkKTtcclxuICAgIGNvbnN0IG5EZWx0YVkgPSBNYXRoLmZsb29yKChuSFJvdyAtIG5IRm9udCkgLyAyKTtcclxuICAgIGNvbnN0IG5YWCA9IDAgKyAoKGNlbGxHcmlkLmdyaWRDb2x1bW4ud2lkdGggLSBuV0xhYmVsKSAvIDIpO1xyXG4gICAgY29uc3QgYlggPSBuWFggPD0gMCB8fCAoblhPbkNlbGwgPj0gblhYICYmIG5YT25DZWxsIDw9IG5YWCArIG5XTGFiZWwpO1xyXG4gICAgaWYgKCFiWCkge1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBjb25zdCBiWSA9IG5EZWx0YVkgPCAwIHx8IChuWU9uQ2VsbCA+PSBuRGVsdGFZICYmIG5ZT25DZWxsIDw9IG5EZWx0YVkgKyBuSEZvbnQpO1xyXG4gICAgcmV0dXJuIGJZO1xyXG4gIH1cclxuXHJcbiAgb25UZXh0Q2xpY2tlZChjZWxsR3JpZCA6IERHLkdyaWRDZWxsKSB7XHJcblxyXG4gICAgaWYgKCB0aGlzLm9uVGV4dENsaWNrQ2FsbGJhY2sgIT09IG51bGwpXHJcbiAgICAgIHRoaXMub25UZXh0Q2xpY2tDYWxsYmFjayhjZWxsR3JpZCk7XHJcbiAgICAvL3dpbmRvdy5vcGVuKFwiaHR0cHM6Ly93d3cudzNzY2hvb2xzLmNvbVwiKTtcclxuICB9XHJcblxyXG4gIG9uTW91c2VVcEV4KGNlbGxHcmlkIDogREcuR3JpZENlbGwsIGUgOiBNb3VzZUV2ZW50LCBuWE9uQ2VsbCA6IG51bWJlciwgbllPbkNlbGwgOiBudW1iZXIpIDogdm9pZCB7XHJcbiAgICBpZiAoZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgIT09ICdhdXRvJylcclxuICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAnYXV0byc7XHJcblxyXG4gICAgaWYoZS5idXR0b24gIT09IDApXHJcbiAgICAgIHJldHVybjtcclxuXHJcbiAgICBjb25zdCBiID0gdGhpcy5pc0NsaWNrYWJsZShjZWxsR3JpZCwgblhPbkNlbGwsIG5ZT25DZWxsKTtcclxuICAgIGlmKGIpXHJcbiAgICAgIHRoaXMub25UZXh0Q2xpY2tlZChjZWxsR3JpZCk7XHJcbiAgfVxyXG5cclxuICBvbk1vdXNlTW92ZUV4KGNlbGxHcmlkIDogREcuR3JpZENlbGwsIGUgOiBNb3VzZUV2ZW50LCBuWE9uQ2VsbCA6IG51bWJlciwgbllPbkNlbGwgOiBudW1iZXIpIDogdm9pZCB7XHJcbiAgICAvL2NvbnNvbGUubG9nKCdNb3ZlJyk7XHJcbiAgICBpZihlLmJ1dHRvbiAhPT0gMClcclxuICAgICAgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IGIgPSB0aGlzLmlzQ2xpY2thYmxlKGNlbGxHcmlkLCBuWE9uQ2VsbCwgbllPbkNlbGwpO1xyXG4gICAgaWYgKGIpIHtcclxuICAgICAgaWYgKGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yICE9PSAncG9pbnRlcicpXHJcbiAgICAgICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSAncG9pbnRlcic7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAoZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgIT09ICdhdXRvJylcclxuICAgICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICdhdXRvJztcclxuICAgIH1cclxuICAgIC8vdGhpcy5vbk1vdXNlTW92ZShjZWxsR3JpZCwgZSk7XHJcbiAgfVxyXG5cclxuICBvbk1vdXNlTGVhdmVFeChjZWxsR3JpZCA6IERHLkdyaWRDZWxsLCBlIDogTW91c2VFdmVudCwgblhPbkNlbGwgOiBudW1iZXIsIG5ZT25DZWxsIDogbnVtYmVyKSA6IHZvaWQge1xyXG4gICAgLy9jb25zb2xlLmxvZygnT3V0Jyk7XHJcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICdhdXRvJztcclxuICAgIC8vdGhpcy5vbk1vdXNlTGVhdmUoY2VsbEdyaWQsIGUpO1xyXG4gIH1cclxufVxyXG4iXX0=